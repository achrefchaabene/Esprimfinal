{% extends 'base.html.twig' %}

{% block title %}Postuler - {{ publication.title }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        /* Styles existants conservés */
    </style>
{% endblock %}

{% block body %}
<div class="application-container">
    {% include 'job_seeker/_sidebar.html.twig' %}
    
    <div class="application-content">
        <a href="{{ path('job_seeker_job_details', {'id': publication.id}) }}" class="back-link">
            <i class="fas fa-arrow-left"></i> Retour à l'offre
        </a>
        
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ label }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endfor %}
        
        <div class="application-card" id="application-form-container">
            <div class="application-steps">
                <div class="step completed">
                    <div class="step-number"><i class="fas fa-check"></i></div>
                    <div class="step-label">Consulter l'offre</div>
                </div>
                <div class="step active">
                    <div class="step-number">2</div>
                    <div class="step-label">Remplir candidature</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-label">Confirmation</div>
                </div>
            </div>
            
            <div class="application-header">
                <h2 class="application-title">Postuler : {{ publication.title }}</h2>
                <div class="company-badge">
                    {% if publication.user.profileImage %}
                        <img src="{{ asset(publication.user.profileImage) }}" alt="Company">
                    {% else %}
                        <img src="{{ asset('img/fxchat.png') }}" alt="Company">
                    {% endif %}
                    {{ publication.user.companyName ?? publication.user.username }}
                </div>
            </div>
            
            {{ form_start(form, {'attr': {'class': 'application-form', 'id': 'application-form'}}) }}
            
            <div class="form-section">
                <h3>Lettre de motivation</h3>
                <div class="form-group">
                    {{ form_label(form.message, 'Votre message', {'label_attr': {'class': 'form-label'}}) }}
                    {{ form_widget(form.message, {'attr': {'class': 'form-control', 'placeholder': 'Présentez-vous et expliquez pourquoi vous êtes intéressé par ce poste...'}}) }}
                    {{ form_errors(form.message) }}
                    <p class="form-help">Soyez concis et mettez en avant vos compétences pertinentes pour ce poste.</p>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Curriculum Vitae</h3>
                <div class="form-group">
                    {{ form_label(form.resumeFile, 'Votre CV', {'label_attr': {'class': 'form-label'}}) }}
                    <div class="file-upload-container" id="file-upload-container">
                        <i class="fas fa-file-pdf" id="file-icon"></i>
                        <p class="file-upload-text" id="file-text">Cliquez ou glissez votre CV ici</p>
                        {{ form_widget(form.resumeFile, {'attr': {'class': 'file-upload-input'}}) }}
                    </div>
                    {{ form_errors(form.resumeFile) }}
                    <p class="form-help">Format accepté: PDF. Taille max: 2MB</p>
                </div>
            </div>
            
            <div class="job-info-section">
                <div class="job-info-header">Détails de l'offre</div>
                <div class="job-info-content">
                    <div class="info-row">
                        <div class="info-label">Entreprise</div>
                        <div class="info-value">{{ publication.user.companyName ?? publication.user.username }}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Poste</div>
                        <div class="info-value">{{ publication.title }}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Catégorie</div>
                        <div class="info-value">
                            {% if publication.category == 'job_offer' %}
                                Offre d'emploi
                            {% elseif publication.category == 'internship' %}
                                Stage
                            {% elseif publication.category == 'news' %}
                                Actualité
                            {% elseif publication.category == 'event' %}
                                Événement
                            {% else %}
                                {{ publication.category }}
                            {% endif %}
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Date de publication</div>
                        <div class="info-value">{{ publication.createdAt|date('d/m/Y') }}</div>
                    </div>
                </div>
            </div>
            
            <div class="btn-container">
                <a href="{{ path('job_seeker_job_details', {'id': publication.id}) }}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Annuler
                </a>
                <button type="submit" class="btn btn-primary" id="submit-application">
                    <i class="fas fa-paper-plane"></i> Envoyer ma candidature
                </button>
            </div>
            
            {{ form_end(form) }}
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion du téléchargement de fichier
        const fileInput = document.querySelector('.file-upload-input');
        const fileText = document.getElementById('file-text');
        const fileIcon = document.getElementById('file-icon');
        const fileContainer = document.getElementById('file-upload-container');
        
        if (fileInput) {
            fileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    const fileName = this.files[0].name;
                    fileText.textContent = fileName;
                    fileIcon.className = 'fas fa-check-circle';
                    fileContainer.style.borderColor = 'var(--success-color)';
                    fileIcon.style.color = 'var(--success-color)';
                } else {
                    fileText.textContent = 'Cliquez ou glissez votre CV ici';
                    fileIcon.className = 'fas fa-file-pdf';
                    fileContainer.style.borderColor = '';
                    fileIcon.style.color = '';
                }
            });
        }
    });
</script>
{% endblock %}



